<!DOCTYPE html>
<html><head><title>Code</title></head><body><style>* {font-family: monospace; }.comment {color: gray;}.keyword {color: #C0A000;}.method {color: brown}.char {color: cornflowerblue}.string {color: cornflowerblue}.indent { padding-left: 0.3em }.operator {color: blue}.decorator {color: #CC9999}.number {color: cornflowerblue}.bracket {color: green}</style><span class="keyword">package</span><span class="indent"> </span><span class="simple_code">Core.Game;</span><br><span class="comment">/**</span><br><span class="comment"> * Created by Владимир on 16.09.2016.</span><br><span class="comment"> */</span><br><br><span class="keyword">import</span><span class="indent"> </span><span class="simple_code">Core.GameCommands.GameCommand;</span><br><span class="keyword">import</span><span class="indent"> </span><span class="simple_code">Core.GameObjects.CatDog;</span><br><span class="keyword">import</span><span class="indent"> </span><span class="simple_code">Core.GameObjects.GameObject;</span><br><span class="keyword">import</span><span class="indent"> </span><span class="simple_code">Core.GameObjects.Snake;</span><br><span class="keyword">import</span><span class="indent"> </span><span class="simple_code">Core.GameUpdatingSystem.GameUpdatingSystem;</span><br><span class="keyword">import</span><span class="indent"> </span><span class="simple_code">Core.MapObjects.DynamicMapObjects.SnakeCell;</span><br><span class="keyword">import</span><span class="indent"> </span><span class="simple_code">Core.MapObjects.MapObject;</span><br><span class="keyword">import</span><span class="indent"> </span><span class="simple_code">Core.MapObjects.StaticMapObjects.Berries.Berry;</span><br><span class="keyword">import</span><span class="indent"> </span><span class="simple_code">Core.MapObjects.StaticMapObjects.EmptyCell;</span><br><span class="keyword">import</span><span class="indent"> </span><span class="simple_code">Core.MapObjects.StaticMapObjects.Wall;</span><br><span class="keyword">import</span><span class="indent"> </span><span class="simple_code">Core.Utils.IntPair;</span><br><br><span class="keyword">import</span><span class="indent"> </span><span class="simple_code">java.io.*;</span><br><span class="keyword">import</span><span class="indent"> </span><span class="simple_code">java.util.ArrayList;</span><br><br><span class="keyword">public</span><span class="indent"> </span><span class="keyword">class</span><span class="indent"> </span><span class="simple_code">Game</span><span class="indent"> </span><span class="keyword">extends</span><span class="indent"> </span><span class="simple_code">AbstractGame</span><span class="indent"> </span><span class="keyword">implements</span><span class="indent"> </span><span class="simple_code">Serializable,</span><span class="indent"> </span><span class="simple_code">Cloneable</span><br><span class="bracket">{</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">public</span><span class="indent"> </span><span class="simple_code">ArrayList</span><span class="operator">&lt;</span><span class="simple_code">GameObject</span><span class="operator">&gt;</span><span class="indent"> </span><span class="simple_code">gameObjects;</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">private</span><span class="indent"> </span><span class="simple_code">GameUpdatingSystem</span><span class="indent"> </span><span class="simple_code">gameUpdatingSystem;</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">private</span><span class="indent"> </span><span class="simple_code">MapObject</span><span class="bracket">[</span><span class="bracket">]</span><span class="bracket">[</span><span class="bracket">]</span><span class="indent"> </span><span class="simple_code">map;</span><br><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">public</span><span class="indent"> </span><span class="keyword">boolean</span><span class="indent"> </span><span class="method">isFinished</span><span class="bracket">(</span><span class="bracket">)</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">{</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">return</span><span class="indent"> </span><span class="simple_code">gameObjects.</span><span class="method">stream</span><span class="bracket">(</span><span class="bracket">)</span><span class="simple_code">.</span><span class="method">anyMatch</span><span class="bracket">(</span><span class="simple_code">GameObject::</span><span class="method">getIsDestructed</span><span class="bracket">)</span><span class="simple_code">;</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">}</span><span class="indent"> </span><span class="comment">// TODO: let gameUpdatingSystem decide when game finishes</span><br><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">public</span><span class="indent"> </span><span class="method">Game</span><span class="bracket">(</span><span class="simple_code">MapObject</span><span class="bracket">[</span><span class="bracket">]</span><span class="bracket">[</span><span class="bracket">]</span><span class="indent"> </span><span class="simple_code">map,</span><span class="indent"> </span><span class="simple_code">ArrayList</span><span class="operator">&lt;</span><span class="simple_code">GameObject</span><span class="operator">&gt;</span><span class="indent"> </span><span class="simple_code">gameObjects,</span><span class="indent"> </span><span class="simple_code">GameUpdatingSystem</span><span class="indent"> </span><span class="simple_code">gameUpdatingSystem</span><span class="bracket">)</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">{</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">this</span><span class="simple_code">.map</span><span class="indent"> </span><span class="simple_code">=</span><span class="indent"> </span><span class="simple_code">map;</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">this</span><span class="simple_code">.gameObjects</span><span class="indent"> </span><span class="simple_code">=</span><span class="indent"> </span><span class="simple_code">gameObjects;</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">this</span><span class="simple_code">.gameUpdatingSystem</span><span class="indent"> </span><span class="simple_code">=</span><span class="indent"> </span><span class="simple_code">gameUpdatingSystem;</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">}</span><br><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">public</span><span class="indent"> </span><span class="keyword">void</span><span class="indent"> </span><span class="method">executeCommand</span><span class="bracket">(</span><span class="simple_code">GameCommand</span><span class="indent"> </span><span class="simple_code">command</span><span class="bracket">)</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">{</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="simple_code">command.</span><span class="method">execute</span><span class="bracket">(</span><span class="keyword">this</span><span class="bracket">)</span><span class="simple_code">;</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">}</span><br><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">public</span><span class="indent"> </span><span class="simple_code">MapObject</span><span class="bracket">[</span><span class="bracket">]</span><span class="bracket">[</span><span class="bracket">]</span><span class="indent"> </span><span class="method">getCurrentMap</span><span class="bracket">(</span><span class="bracket">)</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">{</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">return</span><span class="indent"> </span><span class="simple_code">map;</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">}</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">public</span><span class="indent"> </span><span class="keyword">void</span><span class="indent"> </span><span class="method">setCurrentMap</span><span class="bracket">(</span><span class="simple_code">MapObject</span><span class="bracket">[</span><span class="bracket">]</span><span class="bracket">[</span><span class="bracket">]</span><span class="indent"> </span><span class="simple_code">map</span><span class="bracket">)</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">{</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">this</span><span class="simple_code">.map</span><span class="indent"> </span><span class="simple_code">=</span><span class="indent"> </span><span class="simple_code">map;</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">}</span><br><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="decorator">@Override</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">public</span><span class="indent"> </span><span class="simple_code">ArrayList</span><span class="operator">&lt;</span><span class="simple_code">GameObject</span><span class="operator">&gt;</span><span class="indent"> </span><span class="method">getGameObjects</span><span class="bracket">(</span><span class="bracket">)</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">{</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">return</span><span class="indent"> </span><span class="simple_code">gameObjects;</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">}</span><br><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="decorator">@Override</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">public</span><span class="indent"> </span><span class="simple_code">Game</span><span class="indent"> </span><span class="method">clone</span><span class="bracket">(</span><span class="bracket">)</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">{</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">try</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">{</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">return</span><span class="indent"> </span><span class="bracket">(</span><span class="simple_code">Game</span><span class="bracket">)</span><span class="indent"> </span><span class="keyword">super</span><span class="simple_code">.</span><span class="method">clone</span><span class="bracket">(</span><span class="bracket">)</span><span class="simple_code">;</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">}</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">catch</span><span class="indent"> </span><span class="bracket">(</span><span class="simple_code">CloneNotSupportedException</span><span class="indent"> </span><span class="simple_code">e</span><span class="bracket">)</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">{</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">throw</span><span class="indent"> </span><span class="keyword">new</span><span class="indent"> </span><span class="method">InternalError</span><span class="bracket">(</span><span class="bracket">)</span><span class="simple_code">;</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">}</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">}</span><br><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">public</span><span class="indent"> </span><span class="keyword">void</span><span class="indent"> </span><span class="method">update</span><span class="bracket">(</span><span class="bracket">)</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">{</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">if</span><span class="indent"> </span><span class="bracket">(</span><span class="method">isFinished</span><span class="bracket">(</span><span class="bracket">)</span><span class="bracket">)</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">throw</span><span class="indent"> </span><span class="keyword">new</span><span class="indent"> </span><span class="method">UnsupportedOperationException</span><span class="bracket">(</span><span class="string">&quot;Game finished. Impossible to update.&quot;</span><span class="bracket">)</span><span class="simple_code">;</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="simple_code">gameUpdatingSystem.</span><span class="method">updateGame</span><span class="bracket">(</span><span class="keyword">this</span><span class="bracket">)</span><span class="simple_code">;</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">}</span><br><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">public</span><span class="indent"> </span><span class="keyword">static</span><span class="indent"> </span><span class="simple_code">Game</span><span class="indent"> </span><span class="method">loadGame</span><span class="bracket">(</span><span class="simple_code">String</span><span class="indent"> </span><span class="simple_code">filePath</span><span class="bracket">)</span><span class="indent"> </span><span class="keyword">throws</span><span class="indent"> </span><span class="simple_code">IOException,</span><span class="indent"> </span><span class="simple_code">ClassNotFoundException</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">{</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">try</span><span class="indent"> </span><span class="bracket">(</span><span class="simple_code">FileInputStream</span><span class="indent"> </span><span class="simple_code">stream</span><span class="indent"> </span><span class="simple_code">=</span><span class="indent"> </span><span class="keyword">new</span><span class="indent"> </span><span class="method">FileInputStream</span><span class="bracket">(</span><span class="simple_code">filePath</span><span class="bracket">)</span><span class="bracket">)</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">{</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">return</span><span class="indent"> </span><span class="method">loadGame</span><span class="bracket">(</span><span class="simple_code">stream</span><span class="bracket">)</span><span class="simple_code">;</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">}</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">}</span><br><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">public</span><span class="indent"> </span><span class="keyword">static</span><span class="indent"> </span><span class="simple_code">Game</span><span class="indent"> </span><span class="method">loadGame</span><span class="bracket">(</span><span class="simple_code">FileInputStream</span><span class="indent"> </span><span class="simple_code">fileInputStream</span><span class="bracket">)</span><span class="indent"> </span><span class="keyword">throws</span><span class="indent"> </span><span class="simple_code">IOException,</span><span class="indent"> </span><span class="simple_code">ClassNotFoundException</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">{</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">try</span><span class="indent"> </span><span class="bracket">(</span><span class="simple_code">ObjectInputStream</span><span class="indent"> </span><span class="simple_code">stream</span><span class="indent"> </span><span class="simple_code">=</span><span class="indent"> </span><span class="keyword">new</span><span class="indent"> </span><span class="method">ObjectInputStream</span><span class="bracket">(</span><span class="simple_code">fileInputStream</span><span class="bracket">)</span><span class="bracket">)</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">{</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">return</span><span class="indent"> </span><span class="method">loadGame</span><span class="bracket">(</span><span class="simple_code">stream</span><span class="bracket">)</span><span class="simple_code">;</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">}</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">}</span><br><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">public</span><span class="indent"> </span><span class="keyword">static</span><span class="indent"> </span><span class="simple_code">Game</span><span class="indent"> </span><span class="method">loadGame</span><span class="bracket">(</span><span class="simple_code">ObjectInputStream</span><span class="indent"> </span><span class="simple_code">objectInputStream</span><span class="bracket">)</span><span class="indent"> </span><span class="keyword">throws</span><span class="indent"> </span><span class="simple_code">IOException,</span><span class="indent"> </span><span class="simple_code">ClassNotFoundException</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">{</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">return</span><span class="indent"> </span><span class="bracket">(</span><span class="simple_code">Game</span><span class="bracket">)</span><span class="simple_code">objectInputStream.</span><span class="method">readObject</span><span class="bracket">(</span><span class="bracket">)</span><span class="simple_code">;</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">}</span><br><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">public</span><span class="indent"> </span><span class="keyword">void</span><span class="indent"> </span><span class="method">writeGame</span><span class="bracket">(</span><span class="simple_code">String</span><span class="indent"> </span><span class="simple_code">filePath</span><span class="bracket">)</span><span class="indent"> </span><span class="keyword">throws</span><span class="indent"> </span><span class="simple_code">IOException,</span><span class="indent"> </span><span class="simple_code">ClassNotFoundException</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">{</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">try</span><span class="indent"> </span><span class="bracket">(</span><span class="simple_code">FileOutputStream</span><span class="indent"> </span><span class="simple_code">stream</span><span class="indent"> </span><span class="simple_code">=</span><span class="indent"> </span><span class="keyword">new</span><span class="indent"> </span><span class="method">FileOutputStream</span><span class="bracket">(</span><span class="simple_code">filePath</span><span class="bracket">)</span><span class="bracket">)</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">{</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="method">writeGame</span><span class="bracket">(</span><span class="simple_code">stream</span><span class="bracket">)</span><span class="simple_code">;</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">}</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">}</span><br><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">public</span><span class="indent"> </span><span class="keyword">void</span><span class="indent"> </span><span class="method">writeGame</span><span class="bracket">(</span><span class="simple_code">FileOutputStream</span><span class="indent"> </span><span class="simple_code">fileOutputStream</span><span class="bracket">)</span><span class="indent"> </span><span class="keyword">throws</span><span class="indent"> </span><span class="simple_code">IOException,</span><span class="indent"> </span><span class="simple_code">ClassNotFoundException</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">{</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">try</span><span class="indent"> </span><span class="bracket">(</span><span class="simple_code">ObjectOutputStream</span><span class="indent"> </span><span class="simple_code">stream</span><span class="indent"> </span><span class="simple_code">=</span><span class="indent"> </span><span class="keyword">new</span><span class="indent"> </span><span class="method">ObjectOutputStream</span><span class="bracket">(</span><span class="simple_code">fileOutputStream</span><span class="bracket">)</span><span class="bracket">)</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">{</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="method">writeGame</span><span class="bracket">(</span><span class="simple_code">stream</span><span class="bracket">)</span><span class="simple_code">;</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">}</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">}</span><br><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">public</span><span class="indent"> </span><span class="keyword">void</span><span class="indent"> </span><span class="method">writeGame</span><span class="bracket">(</span><span class="simple_code">ObjectOutputStream</span><span class="indent"> </span><span class="simple_code">objectInputStream</span><span class="bracket">)</span><span class="indent"> </span><span class="keyword">throws</span><span class="indent"> </span><span class="simple_code">IOException,</span><span class="indent"> </span><span class="simple_code">ClassNotFoundException</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">{</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="simple_code">objectInputStream.</span><span class="method">writeObject</span><span class="bracket">(</span><span class="keyword">this</span><span class="bracket">)</span><span class="simple_code">;</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">}</span><br><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">public</span><span class="indent"> </span><span class="keyword">int</span><span class="indent"> </span><span class="method">getAliveSnakeIndex</span><span class="bracket">(</span><span class="bracket">)</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">{</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="simple_code">GameObject</span><span class="bracket">[</span><span class="bracket">]</span><span class="indent"> </span><span class="simple_code">snakes</span><span class="indent"> </span><span class="simple_code">=</span><span class="indent"> </span><span class="simple_code">gameObjects.</span><span class="method">stream</span><span class="bracket">(</span><span class="bracket">)</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="simple_code">.</span><span class="method">filter</span><span class="bracket">(</span><span class="simple_code">gameObject</span><span class="indent"> </span><span class="simple_code">-&gt;</span><span class="indent"> </span><span class="simple_code">gameObject</span><span class="indent"> </span><span class="keyword">instanceof</span><span class="indent"> </span><span class="simple_code">Snake</span><span class="bracket">)</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="simple_code">.</span><span class="method">toArray</span><span class="bracket">(</span><span class="simple_code">GameObject</span><span class="bracket">[</span><span class="bracket">]</span><span class="simple_code">::</span><span class="method">new</span><span class="bracket">)</span><span class="simple_code">;</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="method">for</span><span class="bracket">(</span><span class="keyword">int</span><span class="indent"> </span><span class="simple_code">i</span><span class="indent"> </span><span class="simple_code">=</span><span class="indent"> </span><span class="number">0;</span><span class="indent"> </span><span class="simple_code">i</span><span class="indent"> </span><span class="operator">&lt;</span><span class="indent"> </span><span class="simple_code">snakes.length;</span><span class="indent"> </span><span class="simple_code">++i</span><span class="bracket">)</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">if</span><span class="indent"> </span><span class="bracket">(</span><span class="simple_code">!snakes</span><span class="bracket">[</span><span class="simple_code">i</span><span class="bracket">]</span><span class="simple_code">.</span><span class="method">getIsDestructed</span><span class="bracket">(</span><span class="bracket">)</span><span class="bracket">)</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">return</span><span class="indent"> </span><span class="simple_code">i;</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">return</span><span class="indent"> </span><span class="operator">-</span><span class="number">1;</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">}</span><br><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">public</span><span class="indent"> </span><span class="simple_code">MapObject</span><span class="indent"> </span><span class="method">getCellAt</span><span class="bracket">(</span><span class="simple_code">IntPair</span><span class="indent"> </span><span class="simple_code">coordinates</span><span class="bracket">)</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">{</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">return</span><span class="indent"> </span><span class="method">getCurrentMap</span><span class="bracket">(</span><span class="bracket">)</span><span class="bracket">[</span><span class="simple_code">coordinates.x</span><span class="bracket">]</span><span class="bracket">[</span><span class="simple_code">coordinates.y</span><span class="bracket">]</span><span class="simple_code">;</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">}</span><br><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="decorator">@Override</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">public</span><span class="indent"> </span><span class="simple_code">String</span><span class="indent"> </span><span class="method">toString</span><span class="bracket">(</span><span class="bracket">)</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">{</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="simple_code">StringBuilder</span><span class="indent"> </span><span class="simple_code">builder</span><span class="indent"> </span><span class="simple_code">=</span><span class="indent"> </span><span class="keyword">new</span><span class="indent"> </span><span class="method">StringBuilder</span><span class="bracket">(</span><span class="bracket">)</span><span class="simple_code">;</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="simple_code">MapObject</span><span class="bracket">[</span><span class="bracket">]</span><span class="bracket">[</span><span class="bracket">]</span><span class="indent"> </span><span class="simple_code">map</span><span class="indent"> </span><span class="simple_code">=</span><span class="indent"> </span><span class="method">getCurrentMap</span><span class="bracket">(</span><span class="bracket">)</span><span class="simple_code">;</span><br><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">for</span><span class="indent"> </span><span class="bracket">(</span><span class="keyword">int</span><span class="indent"> </span><span class="simple_code">i</span><span class="indent"> </span><span class="simple_code">=</span><span class="indent"> </span><span class="number">0;</span><span class="indent"> </span><span class="simple_code">i</span><span class="indent"> </span><span class="operator">&lt;</span><span class="indent"> </span><span class="method">getWidth</span><span class="bracket">(</span><span class="bracket">)</span><span class="simple_code">;</span><span class="indent"> </span><span class="simple_code">++i</span><span class="bracket">)</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">{</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">for</span><span class="indent"> </span><span class="bracket">(</span><span class="keyword">int</span><span class="indent"> </span><span class="simple_code">j</span><span class="indent"> </span><span class="simple_code">=</span><span class="indent"> </span><span class="number">0;</span><span class="indent"> </span><span class="simple_code">j</span><span class="indent"> </span><span class="operator">&lt;</span><span class="indent"> </span><span class="method">getHeight</span><span class="bracket">(</span><span class="bracket">)</span><span class="simple_code">;</span><span class="indent"> </span><span class="simple_code">++j</span><span class="bracket">)</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">if</span><span class="indent"> </span><span class="bracket">(</span><span class="simple_code">map</span><span class="bracket">[</span><span class="simple_code">i</span><span class="bracket">]</span><span class="bracket">[</span><span class="simple_code">j</span><span class="bracket">]</span><span class="indent"> </span><span class="keyword">instanceof</span><span class="indent"> </span><span class="simple_code">Wall</span><span class="bracket">)</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="simple_code">builder.</span><span class="method">append</span><span class="bracket">(</span><span class="char">'#'</span><span class="bracket">)</span><span class="simple_code">;</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">else</span><span class="indent"> </span><span class="keyword">if</span><span class="indent"> </span><span class="bracket">(</span><span class="simple_code">map</span><span class="bracket">[</span><span class="simple_code">i</span><span class="bracket">]</span><span class="bracket">[</span><span class="simple_code">j</span><span class="bracket">]</span><span class="indent"> </span><span class="keyword">instanceof</span><span class="indent"> </span><span class="simple_code">EmptyCell</span><span class="bracket">)</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="simple_code">builder.</span><span class="method">append</span><span class="bracket">(</span><span class="char">'.'</span><span class="bracket">)</span><span class="simple_code">;</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">else</span><span class="indent"> </span><span class="keyword">if</span><span class="indent"> </span><span class="bracket">(</span><span class="simple_code">map</span><span class="bracket">[</span><span class="simple_code">i</span><span class="bracket">]</span><span class="bracket">[</span><span class="simple_code">j</span><span class="bracket">]</span><span class="indent"> </span><span class="keyword">instanceof</span><span class="indent"> </span><span class="simple_code">Berry</span><span class="bracket">)</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="simple_code">builder.</span><span class="method">append</span><span class="bracket">(</span><span class="char">'B'</span><span class="bracket">)</span><span class="simple_code">;</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">else</span><span class="indent"> </span><span class="keyword">if</span><span class="indent"> </span><span class="bracket">(</span><span class="simple_code">map</span><span class="bracket">[</span><span class="simple_code">i</span><span class="bracket">]</span><span class="bracket">[</span><span class="simple_code">j</span><span class="bracket">]</span><span class="indent"> </span><span class="keyword">instanceof</span><span class="indent"> </span><span class="simple_code">SnakeCell</span><span class="bracket">)</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="simple_code">builder.</span><span class="method">append</span><span class="bracket">(</span><span class="char">'S'</span><span class="bracket">)</span><span class="simple_code">;</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="simple_code">builder.</span><span class="method">append</span><span class="bracket">(</span><span class="char">'\n'</span><span class="bracket">)</span><span class="simple_code">;</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">}</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="keyword">return</span><span class="indent"> </span><span class="simple_code">builder.</span><span class="method">toString</span><span class="bracket">(</span><span class="bracket">)</span><span class="simple_code">;</span><br><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="indent"> </span><span class="bracket">}</span><br><span class="bracket">}</span><br></body></html>